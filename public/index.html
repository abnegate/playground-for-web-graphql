<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Appwrite GraphQL Playground</title>
    <meta name="description" content="A simple Appwrite demo app for getting started with GraphQL API integration" />
    <meta name="author" content="Appwrite Team" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous" />
    <link href="https://fonts.googleapis.com/css?family=Poppins:100,300,400,500,600,800" />
    <link rel="icon" type="image/png" href="https://appwrite.io/images/favicon.png?v=1" />
    <link rel="stylesheet" href="stylesheet.css" />

    <style>
        body {
            font-family: Poppins, sans-serif, Arial;
            -webkit-font-smoothing: antialiased;
            font-weight: 500;
        }
        #list > li:hover {
            color: #007BFF;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-dark bg-dark">
        <a class="navbar-brand" href="#"><img src="https://appwrite.io/images/appwrite-white.svg" height="22" />
            &nbsp;playground</a>
        <a href="https://graphql.org"><img src="images/graphql.svg" height="36"/></a>
    </nav>
    <div class="jumbotron jumbotron-fluid">
        <div class="container">
            <h1 class="display-5 mb-5">Hello Appwriters!</h1>
            <p class="lead">
                Appwrite playground is a simple way to explore the Appwrite <b>GraphQL</b> API and Web
                SDK. Use the <a href="https://github.com/appwrite/playground-for-web-graphql/blob/master/public/index.html" target="_blank">source code</a>
                of this page to learn how to use the different Appwrite GraphQL features.
                <br />
                <br />
                Check the <b>developer console</b> for the full response of each request.
            </p>
        </div>
    </div>

    <div class="container">
        <h2 class="mb-5">Authentication</h2>

        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="isLogged()">
            Is Logged In?
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="loginAnonymously()">
            Login Anonymously
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="loginWithGoogle()">
            Login With Google
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="loginWithFacebook()">
            Login With Facebook
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="loginWithGithub()">
            Login With Github
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="loginWithApple()">
            Login With Apple
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="createJWT()">
            Create JWT
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="getAccountName()">
            Get Account Name
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="getAccountEmail()">
            Get Account Email
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="getSessions()">
            Get Account Sessions
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="getLogs()">
            Get Account Logs
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="deleteSessions()">
            Delete All Sessions
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="deleteCurrentSession()">
            Delete Current Session
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="createTeam()">
            Create Team
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="createTeamMembership()">
            Create Team Membership
        </button>
    </div>

    <hr class="mb-5" />

    <div class="container">
        <div class="row">
            <div class="col-sm mb-5">
                <h3 class="mb-4">Register</h3>
                <form onsubmit="register(event);">
                    <div class="form-group">
                        <label for="register-email">Email</label>
                        <input type="email" class="form-control" id="register-email" placeholder="Enter email"
                            value="demo@example.com" required />
                    </div>
                    <div class="form-group">
                        <label for="register-password">Password</label>
                        <input type="password" class="form-control" id="register-password" placeholder="Password"
                            value="password" required pattern=".{6,}" title="Six or more characters" />
                    </div>
                    <button type="submit" class="btn btn-primary">Sign Up</button>
                </form>
            </div>
            <div class="col-sm mb-5">
                <h3 class="mb-4">Login</h3>
                <form onsubmit="login(event);">
                    <div class="form-group">
                        <label for="login-email">Email</label>
                        <input type="email" class="form-control" id="login-email" placeholder="Enter email"
                            value="demo@example.com" required />
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" class="form-control" id="login-password" placeholder="Password"
                            value="password" required pattern=".{6,}" title="Six or more characters" />
                    </div>
                    <button type="submit" class="btn btn-primary">Sign In</button>
                </form>
            </div>
        </div>
    </div>

    <hr class="mb-5" />

    <div class="container">
        <h2 class="mb-5">Storage</h2>
        <div class="row">
            <div class="col-sm mb-5">
                <h3 class="mb-4">Add File</h3>
                <div class="input-group">
                    <div class="custom-file">
                      <input type="file" class="custom-file-input" id="uploader" aria-describedby="inputGroupFileAddon04">
                      <label class="custom-file-label" id="uploader-label" for="uploader">Choose file</label>
                    </div>
                    <div class="input-group-append">
                      <button class="btn btn-primary" type="button" id="inputGroupFileAddon04" onclick="createFile()">Upload File</button>
                    </div>
                  </div>
            </div>
            <div class="col-sm mb-5">
                <h3 class="mb-4">List Files</h3>
                <button type="button" class="btn btn-primary" onclick="listFiles()">
                    List Files
                </button>
                <div class="container mt-3">
                    <div class="row">
                        <ul id="list"></ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm mb-5">
                <h3 class="mb-4">Get File</h3>
                <form onsubmit="getFile(event)">
                    <div class="form-group">
                        <label for="get-file-id">File ID</label>
                        <input required type="text" class="form-control" id="get-file-id" placeholder="Enter file ID" value="62af4fvgf5sdgy63bdf" />
                    </div>
                    <button type="submit" class="btn btn-primary">Get</button>
                </form>
            </div>

            <div class="col-sm mb-5">
                <h3 class="mb-4">Update File</h3>
                <form onsubmit="updateFile(event)">
                    <div class="form-group">
                        <label for="update-file-id">File ID</label>
                        <input required type="text" class="form-control" id="update-file-id" placeholder="Enter file ID" value="62af4fvgf5sdgy63bdf" />
                    </div>
                    <div class="form-group">
                        <label for="update-file-name">New Name</label>
                        <input required type="text" class="form-control" id="update-file-name" placeholder="New name" value="Updated Name" />
                    </div>
                    <button type="submit" class="btn btn-primary">Update</button>
                </form>
            </div>

            <div class="col-sm mb-5">
                <h3 class="mb-4">Delete File</h3>
                <form onsubmit="deleteFile(event)">
                    <div class="form-group">
                        <label for="delete-file-id">File ID</label>
                        <input required type="text" class="form-control" id="delete-file-id" placeholder="Enter file ID" value="62af4fvgf5sdgy63bdf" />
                    </div>
                    <button type="submit" class="btn btn-primary">Delete</button>
                </form>
            </div>
        </div>
    </div>

    <hr class="mb-5" />

    <div class="container">
        <h2 class="mb-5">Databases</h2>
        <div class="row">
            <div class="col-sm mb-5">
                <h3 class="mb-4">Add Document</h3>
                <form onsubmit="createDocument(event)">
                    <div class="form-group">
                        <label for="create-document-id">Name</label>
                        <input required type="text" class="form-control" id="create-document-id" placeholder="Enter document name data" value="GraphQL" />
                    </div>
                    <button type="submit" class="btn btn-primary">Add</button>
                </form>
            </div>
            <div class="col-sm mb-5">
                <h3 class="mb-4">List Documents</h3>
                <button type="button" class="btn btn-primary" onclick="listDocuments()">
                    List Documents
                </button>
                <div class="container mt-3">
                    <div class="row">
                        <ul id="document-list"></ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm mb-5">
                <h3 class="mb-4">Get Document</h3>
                <form onsubmit="getDocument(event)">
                    <div class="form-group">
                        <label for="get-document-id">Document ID</label>
                        <input required type="text" class="form-control" id="get-document-id" placeholder="Enter document ID" value="62af4fvgf5sdgy63bdf" />
                    </div>
                    <button type="submit" class="btn btn-primary">Get</button>
                </form>
            </div>

            <div class="col-sm mb-5">
                <h3 class="mb-4">Update Document</h3>
                <form onsubmit="updateDocument(event)">
                    <div class="form-group">
                        <label for="update-document-id">Document ID</label>
                        <input required type="text" class="form-control" id="update-document-id" placeholder="Enter document ID" value="62af4fvgf5sdgy63bdf" />
                    </div>
                    <div class="form-group">
                        <label for="update-document-name">New Name</label>
                        <input required type="text" class="form-control" id="update-document-name" placeholder="New name" value="Updated Name" />
                    </div>
                    <button type="submit" class="btn btn-primary">Update</button>
                </form>
            </div>

            <div class="col-sm mb-5">
                <h3 class="mb-4">Delete Document</h3>
                <form onsubmit="deleteDocument(event)">
                    <div class="form-group">
                        <label for="delete-document-id">Document ID</label>
                        <input required type="text" class="form-control" id="delete-document-id" placeholder="Enter document ID" value="62af4fvgf5sdgy63bdf" />
                    </div>
                    <button type="submit" class="btn btn-primary">Delete</button>
                </form>
            </div>
        </div>
    </div>

    <hr class="mb-5" />

    <div class="container">
        <h2 class="mb-5">Functions</h2>
        <div class="row">
            <div class="col-sm mb-5">
                <h3 class="mb-4">Create Execution</h3>
                <form onsubmit="createExecution(event)">
                    <div class="form-group">
                        <label for="create-execution-id">Function ID</label>
                        <input required type="text" class="form-control" id="create-execution-id" placeholder="Enter function ID" value="62afef3456fdg3agj" />
                    </div>
                    <button type="submit" class="btn btn-primary">Execute</button>
                </form>
            </div>
            <div class="col-sm mb-5">
                <h3 class="mb-4">List Executions</h3>
                <button type="button" class="btn btn-primary" onclick="listExecutions()">
                    List Executions
                </button>
                <div class="container mt-3">
                    <div class="row">
                        <ul id="execution-list"></ul>
                    </div>
                </div>
            </div>
            <div class="col-sm mb-5">
                <h3 class="mb-4">Get Execution</h3>
                <form onsubmit="getExecution(event)">
                    <div class="form-group">
                        <label for="get-execution-id">Execution ID</label>
                        <input required type="text" class="form-control" id="get-execution-id" placeholder="Enter execution ID" value="62af4fvgf5sdgy63bdf" />
                    </div>
                    <button type="submit" class="btn btn-primary">Get</button>
                </form>
            </div>
        </div>
    </div>

    <hr class="mb-5" />

    <div class="container">
        <h2 class="mb-5">Locale</h2>

        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="getLocation()">
            Get User Location
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="getIP()">
            Get User IP
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="isEU()">
            Is User a Member of the EU?
        </button>
    </div>

    <!-- Include Appwrite Web SDK before trying to create a new instance -->

    <!-- Fetch the latest sdk or use an existing one -->
    <script src="sdk.js"></script>

    <script>

        document.getElementById('uploader').onchange = function () {
            document.getElementById('uploader-label').innerHTML = this.files[0].name;
        };

        // Before we start doing anything, we need to init our Appwrite Web SDK
        const client = new Appwrite.Client();

        client
            .setEndpoint("https://8080-appwrite-appwrite-f0f48rxk0hl.ws-eu54.gitpod.io/v1") // Set your own appwrite server endpoint here, if not sure, you can get this value from your project settings page.
            .setProject("dev"); // Your Appwrite Project UID, you can get it from your project settings page.

        // Prepare all services we are going to use
        const graphql = new Appwrite.Graphql(client);

        /**
         * Please Note!
         *
         * Don't ever integrate your Appwrite SDK with a secret key on client apps
         * like browsers, Android apps, iOS apps and other client platforms
         * like electron, XBOX and others.
         */

        const realtimeElement = document.getElementById("realtime");

        client.subscribe("files", async function(response) {
            const entry = document.createElement("li");
            const bytes = await graphql.post({
                query: `query GetFilePreview ($bucketId: String!, $fileId: String!, $width: Int) {
                    storageGetFilePreview(bucketId: $bucketId, fileId: $fileId, width: $width) {
                        status
                    }
                }`,
                variables: {
                    bucketId: "testbucket",
                    fileId: response.payload.$id,
                    width: 250,
                }
            })
            let image = `data:image/jpg;base64,${btoa(bytes)}`;

            entry.classList.add('list-group-item');
            entry.innerHTML = `<a href="${url}" target=_blank><b>Events</b>: ${response.events}<br><img src="${image}" /></a>`;
            realtimeElement.prepend(entry);
        });

        client.subscribe(['teams', 'memberships', 'accounts'], function(response) {
            console.log(response)
        });

        /*
         * Account
         */

        function isLogged() {
            let promise = graphql.post({
                query: `{ accountGet { _id } }`
            });

            promise.then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("You are not logged in!");
                    return;
                }

                alert("You are logged in!");
            });
        }

        function getAccountName() {
            let promise = graphql.post({
                query: `{ accountGet { name } }`
            });

            promise.then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("You are not logged in!");
                    return;
                }

                alert(response.data.accountGet.name);
            });
        }

        function getAccountEmail() {
            let promise = graphql.post({
                query: `{ accountGet { email } }`
            });

            promise.then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("You are not logged in!");
                    return;
                }

                alert(response.data.accountGet.email);
            });
        }

        function getSessions() {
            let promise = graphql.post({
                query: `{ accountListSessions { total sessions { userId } } }`
            });

            promise.then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("You are not logged in!");
                    return;
                }

                alert(`User has ${response.data.accountListSessions.total} active sessions. Check developer console for more info`);
            });
        }

        function getLogs() {
            let promise = graphql.post({
                query: `{ accountListLogs { total logs { event } } }`
            });

            promise.then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("You are not logged in!");
                    return;
                }

                alert(`User has ${response.data.accountListLogs.total} logs. Check developer console for more info`);
            });
        }

        function register(event) {
            event.preventDefault();

            graphql.post({
                query: `mutation CreateAccount ($email: String!, $password: String!, $name: String) {
                    accountCreate(userId: "${Appwrite.ID.unique()}", email: $email, password: $password, name: $name) {
                        _id
                    }
                }`,
                variables: {
                    email: event.target.elements["register-email"].value,
                    password: event.target.elements["register-password"].value,
                }
            }).then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("Failed to create account!");
                    return;
                }

                alert("Account created successfully!");
            });
        }

        function loginAnonymously() {
            graphql.post({
                query: `mutation { accountCreateAnonymousSession { _id }}`
            }).then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("Failed to create anonymous account!");
                    return;
                }

                alert("User logged in anonymously!");
            });
        }

        function createJWT() {
            graphql.post({
                query: `mutation { accountCreateJWT { secret }}`
            }).then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("Failed to create JWT!");
                    return;
                }

                alert("JWT created!");
            });
        }

        function login(event) {
            event.preventDefault();

            graphql.post({
                query: `mutation CreateEmailSession ($email: String!, $password: String!) {
                    accountCreateEmailSession(email: $email, password: $password) { _id }
                }`,
                variables: {
                    email: event.target.elements["login-email"].value,
                    password: event.target.elements["login-password"].value,
                }
            }).then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("Failed to login!");
                    return;
                }

                alert("User logged in!");

                client.subscribe("account", function(response) {
                    console.log('Received Account event', response);
                });
            });
        }

        function loginWithGoogle(event) {
            /**
             * Callback URLs are required for creating a browser
             *  session cookie due to some browsers 3rd party cookie policy limitations,
             *  this is not required for other client based platforms
             */
            graphql.post({
                query: `query OAuthLogin ($provider: String!, $success: String, $failure: String) {
                    accountCreateOAuth2Session(provider: $provider, success: $success, failure: $failure) {
                        status
                    }
                }`,
                variables: {
                    provider: "google",
                    success: "http://localhost:8000/?success",
                    failure: "http://localhost:8000/?failure",
                }
            }).then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("Failed to login with Google!");
                    return;
                }

                alert("User logged in with Google!");
            });
        }

        function loginWithFacebook(event) {
            /**
             * Callback URLs are required for creating a browser
             *  session cookie due to some browsers 3rd party cookie policy limitations,
             *  this is not required for other client based platforms
             */
            graphql.post({
                query: `query OAuthLogin ($provider: String!, $success: String, $failure: String) {
                    accountCreateOAuth2Session(provider: $provider, success: $success, failure: $failure) {
                        status
                    }
                }`,
                variables: {
                    provider: "facebook",
                    success: "http://localhost:8000/?success",
                    failure: "http://localhost:8000/?failure",
                }
            }).then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("Failed to login with Facebook!");
                    return;
                }

                alert("User logged in with Facebook!");
            });
        }

        function loginWithGithub(event) {
            /**
             * Callback URLs are required for creating a browser
             *  session cookie due to some browsers 3rd party cookie policy limitations,
             *  this is not required for other client based platforms
             */
            graphql.post({
                query: `query OAuthLogin ($provider: String!, $success: String, $failure: String) {
                    accountCreateOAuth2Session(provider: $provider, success: $success, failure: $failure) {
                        status
                    }
                }`,
                variables: {
                    provider: "github",
                    success: "http://localhost:8000/?success",
                    failure: "http://localhost:8000/?failure",
                }
            }).then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("Failed to login with GitHub!");
                    return;
                }

                alert("User logged in with GitHub!");
            });
        }

        function loginWithApple(event) {
            /**
             * Callback URLs are required for creating a browser
             *  session cookie due to some browsers 3rd party cookie policy limitations,
             *  this is not required for other client based platforms
             */
            graphql.post({
                query: `query OAuthLogin ($provider: String!, $success: String, $failure: String) {
                    accountCreateOAuth2Session(provider: $provider, success: $success, failure: $failure) {
                        status
                    }
                }`,
                variables: {
                    provider: "apple",
                    success: "http://localhost:8000/?success",
                    failure: "http://localhost:8000/?failure",
                }
            }).then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("Failed to login with Apple!");
                    return;
                }

                alert("User logged in with Apple!");
            });
        }

        function deleteSessions() {
            graphql.post({
                query: `mutation { accountDeleteSessions }`
            }).then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("Failed to delete sessions!");
                    return;
                }

                alert("Sessions deleted!");
            });
        }

        function deleteCurrentSession() {
            graphql.post({
                query: `mutation { accountDeleteSession(sessionId: "current") }`
            }).then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("Failed to delete current session!");
                    return;
                }

                alert("Current session deleted!");
            });
        }

        function createTeam() {
            graphql.post({
                query: `mutation CreateTeam ($teamId: String!, $name: String!) {
                    teamsCreate(teamId: $teamId, name: $name) { _id }
                }`,
                variables: {
                    teamId: Appwrite.ID.unique(),
                    name: "My Team",
                }
            }).then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("Failed to create team!");
                    return;
                }

                this.teamId = response.data.teamsCreate._id;

                alert("Team created!");
            });
        }

        function createTeamMembership() {
            let random = Math.floor(1000 + Math.random() * 9000);
            let email = "test+" + random + "@test.com";

            graphql.post({
                query: `mutation CreateTeamMembership ($teamId: String!, $email: String!, $roles: [String!]!, $url: String!) {
                    teamsCreateMembership(teamId: $teamId, email: $email, roles: $roles, url: $url) { _id }
                }`,
                variables: {
                    teamId: this.teamId,
                    email: email,
                    roles: ["admin"],
                    url: "http://localhost",
                }
            }).then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("Failed to create team membership!");
                    return;
                }

                alert("Team membership created!");
            });
        }

        /*
         * Storage
         */

        function createFile() {

            /*
             * SDK can't upload files yet, so we use the API
             */

            const data = new FormData();

            data.append('operations', JSON.stringify({
                query: `mutation CreateFile ($bucketId: String!, $fileId: String!, $file: InputFile, $fileSecurity: Bool, $permissions: [String!]) {
                        storageCreateFile(bucketId: $bucketId, fileId: $fileId, file: $file, fileSecurity: $fileSecurity, permissions: $permissions) { _id }
                }`,
                variables: {
                    bucketId: this.bucketId,
                    fileId: Appwrite.ID.unique(),
                    file: null,
                    fileSecurity: true,
                    permissions: [
                        Appwrite.Permission.read(Appwrite.Role.any()),
                        Appwrite.Permission.write(Appwrite.Role.users())
                    ],
                }
            }));

            data.append('map', JSON.stringify({
                file: ['variables.file']
            }));

            data.append('file', document.getElementById('uploader').files[0]);

            fetch(
                'http://localhost/v1/graphql', {
                method: 'POST',
                headers: {
                    'Cookie': this.authCookie,
                },
                body: data
            }).then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("Failed to create file!");
                    return;
                }

                this.fileId = response.data.storageCreateFile._id;

                alert("File created!");
            });
        }

        function listFiles() {
            graphql.post({
                query: `query ListFiles ($bucketId: String!) {
                    storageListFiles(bucketId: $bucketId) { total files { _id name } }
                }`,
                variables: {
                    bucketId: this.bucketId,
                }
            }).then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("Failed to list files!");
                    return;
                }

                const ul = document.getElementById("list");
                ul.innerHTML = '';
                for(let i = 0; i < response.data.storageListFiles.total; i++){
                    const li = document.createElement("li");

                    li.innerHTML = response.data.storageListFiles.files[i].name;

                    li.onclick = function () {
                        getFile(response.data.storageListFiles.files[i]._id);
                    };

                    ul.appendChild(li);
                }
            });
        }

        function getFile() {
            graphql.post({
                query: `query GetFile ($bucketId: String!, $fileId: String!) {
                    storageGetFile(bucketId: $bucketId, fileId: $fileId) {
                        _id
                        _createdAt
                        _updatedAt
                        name
                        bucket
                        size
                    }
                }`,
                variables: {
                    bucketId: this.bucketId,
                    fileId: this.fileId,
                }
            }).then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("Failed to get file!");
                    return;
                }

                alert("Got file successfully!");
            });
        }

        function updateFile() {
            graphql.post({
                query: `mutation UpdateFile ($bucketId: String!, $fileId: String!, $name: String!) {
                    storageUpdateFile(bucketId: $bucketId, fileId: $fileId, name: $name) { _id }
                }`,
                variables: {
                    bucketId: this.bucketId,
                    fileId: this.fileId,
                    name: "New Name",
                }
            }).then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("Failed to update file!");
                    return;
                }

                alert("File updated!");
            });
        }

        function deleteFile() {
            graphql.post({
                query: `mutation DeleteFile ($bucketId: String!, $fileId: String!) {
                    storageDeleteFile(bucketId: $bucketId, fileId: $fileId) { status }
                }`,
                variables: {
                    bucketId: this.bucketId,
                    fileId: this.fileId,
                }
            }).then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("Failed to delete file!");
                    return;
                }

                alert("File deleted!");
            });
        }

        /*
         * Databases
         */

        function createDocument() {
            graphql.post({
                query: `mutation CreateDocument ($databaseId: String!, $collectionId: String!, $documentId: String!, $data: JSON) {
                    databasesCreateDocument(databaseId: $databaseId, collectionId: $collectionId, documentId: $documentId, data: $data) { _id }
                }`,
                variables: {
                    databaseId: this.databaseId,
                    collectionId: this.collectionId,
                    documentId: Appwrite.ID.unique(),
                    data: {
                        name: "My Document",
                    },
                }
            }).then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("Failed to create document!");
                    return;
                }

                this.documentId = response.data.databasesCreateDocument._id;

                alert("Document created!");
            });
        }

        function getDocument() {
            graphql.post({
                query: `query GetDocument ($databaseId: String!, $collectionId: String!, $documentId: String!) {
                    databasesGetDocument(databaseId: $databaseId, collectionId: $collectionId, documentId: $documentId) {
                        _id
                        _createdAt
                        _updatedAt
                        name
                        collection
                        size
                    }
                }`,
                variables: {
                    databaseId: this.databaseId,
                    collectionId: this.collectionId,
                    documentId: this.documentId,
                }
            }).then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("Failed to get document!");
                    return;
                }

                alert("Got document successfully!");
            });
        }

        function listDocuments() {
            graphql.post({
                query: `query ListDocuments ($databaseId: String!, $collectionId: String!) {
                    databasesListDocuments(databaseId: $databaseId, collectionId: $collectionId) { total documents { _id name } }
                }`,
                variables: {
                    databaseId: this.databaseId,
                    collectionId: this.collectionId,
                }
            }).then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("Failed to list documents!");
                    return;
                }

                const ul = document.getElementById("list");
                ul.innerHTML = '';
                for(let i = 0; i < response.data.databasesListDocuments.total; i++){
                    const li = document.createElement("li");

                    li.innerHTML = response.data.databasesListDocuments.documents[i].name;

                    li.onclick = function () {
                        getDocument(response.data.databasesListDocuments.documents[i]._id);
                    };

                    ul.appendChild(li);
                }
            });
        }

        function updateDocument() {
            graphql.post({
                query: `mutation UpdateDocument ($databaseId: String!, $collectionId: String!, $documentId: String!, $data: JSON) {
                    databasesUpdateDocument(databaseId: $databaseId, collectionId: $collectionId, documentId: $documentId, data: $data) { _id }
                }`,
                variables: {
                    databaseId: this.databaseId,
                    collectionId: this.collectionId,
                    documentId: this.documentId,
                    data: {
                        name: "My Updated Document",
                    },
                }
            }).then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("Failed to update document!");
                    return;
                }

                alert("Document updated!");
            });
        }

        function deleteDocument() {
            graphql.post({
                query: `mutation DeleteDocument ($databaseId: String!, $collectionId: String!, $documentId: String!) {
                    databasesDeleteDocument(databaseId: $databaseId, collectionId: $collectionId, documentId: $documentId) { status }
                }`,
                variables: {
                    databaseId: this.databaseId,
                    collectionId: this.collectionId,
                    documentId: this.documentId,
                }
            }).then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("Failed to delete document!");
                    return;
                }

                alert("Document deleted!");
            });
        }

        /*
         * Functions
         */

        function createExecution() {
            graphql.post({
                query: `mutation CreateExecution ($functionId: String!, $data: JSON) {
                    functionsCreateExecution(functionId: $functionId, data: $data) { _id }
                }`,
                variables: {
                    functionId: this.functionId,
                    data: {
                        name: "My Execution",
                    },
                }
            }).then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("Failed to create execution!");
                    return;
                }

                this.executionId = response.data.functionsCreateExecution._id;

                alert("Execution created!");
            });
        }

        function listExecutions() {
            graphql.post({
                query: `query ListExecutions ($functionId: String!) {
                    functionsListExecutions(functionId: $functionId) { total executions { _id name } }
                }`,
                variables: {
                    functionId: this.functionId,
                }
            }).then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("Failed to list executions!");
                    return;
                }

                const ul = document.getElementById("list");
                ul.innerHTML = '';
                for(let i = 0; i < response.data.functionsListExecutions.total; i++){
                    const li = document.createElement("li");

                    li.innerHTML = response.data.functionsListExecutions.executions[i].name;

                    li.onclick = function () {
                        this.getExecution(response.data.functionsListExecutions.executions[i]._id);
                    };

                    ul.appendChild(li);
                }
            });
        }

        function getExecution() {
            graphql.post({
                query: `query GetExecution ($functionId: String!, $executionId: String!) {
                    functionsGetExecution(functionId: $functionId, executionId: $executionId) {
                        _id
                        _createdAt
                        _updatedAt
                        trigger
                        status
                        statusCode
                        stdout
                        stderr
                        duration
                    }
                }`,
                variables: {
                    functionId: this.functionId,
                    executionId: this.executionId,
                }
            }).then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("Failed to get execution!");
                    return;
                }

                alert("Got execution successfully!");
            });
        }

        /*
         * Locale
         */

        function getLocation() {
            graphql.post({
                query: `query { localeGet { country countryCode } }`
            }).then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("Failed to get locale!");
                    return;
                }

                alert(
                    "User is from " +
                    response.data.localeGet.country +
                    ", country code is: " +
                    response.data.localeGet.countryCode
                );
            });
        }

        function getIP() {
            graphql.post({
                query: `query { localeGet { ip } }`
            }).then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("Failed to get IP!");
                    return;
                }

                alert("User IP is " + response.data.localeGet.ip);
            });
        }

        function isEU() {
            graphql.post({
                query: `query { localeGet { eu}}`
            }).then(function (response) {
                console.log(response);

                if ('errors' in response) {
                    alert("Failed to get EU status!");
                    return;
                }

                alert(response.data.localeGet.eu
                    ? "User is a member of the EU"
                    : "User is not a member of the EU"
                );
            });
        }
    </script>
</body>

</html>
